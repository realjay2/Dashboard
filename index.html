<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hybrid Dash</title>
<style>
:root{
  --bg:#0e141b; --panel:#141c24; --panel-2:#111822;
  --muted:#8aa0b6; --text:#e8f0fb;
  --primary:#3b82f6; --primary-2:#2563eb;
  --accent:#60a5fa;
  --shadow:0 6px 20px rgba(0,0,0,.35) inset,0 0 0 1px rgba(255,255,255,.03) inset;
}
body,*{user-select:none;box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:500 16px/1.4 ui-sans-serif,system-ui;cursor:none;}
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:linear-gradient(180deg,#111a25,#0d141c);padding:18px 14px;position:sticky;top:0;height:100vh;border-right:1px solid rgba(255,255,255,.04);position:relative;}
.brand{font-weight:800;font-size:22px;display:flex;align-items:center;margin:6px 10px 18px;}
.brand img{width:28px;height:28px;margin-right:8px;}
.nav{display:flex;flex-direction:column;gap:10px;margin-top:6px}
.nav a{padding:12px 14px;border-radius:10px;text-decoration:none;color:var(--text);cursor:pointer;}
.nav a:hover{background:rgba(255,255,255,.05)}
.nav a.active{background:rgba(59,130,246,.18);}
.main{padding:34px}
.header h1{margin:0 0 8px;font-size:32px}
.sub{color:var(--muted);margin-bottom:20px}
.card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:var(--shadow);}
.btn{display:inline-block;background:linear-gradient(180deg,var(--primary),var(--primary-2));color:#fff;border-radius:8px;font-weight:700;padding:12px 14px;text-decoration:none;text-align:center;width:100%}
.btn:hover{opacity:.9;cursor:pointer}
.tab-section{display:none}
.tab-section.active{display:block}

/* Sidebar User Box */
#user-box{
  position:absolute;bottom:80px;left:14px;width:calc(100% - 28px);
  background:rgba(255,255,255,0.05);padding:10px;border-radius:10px;
  display:none;align-items:center;gap:10px;
}
#user-box img{width:32px;height:32px;border-radius:50%;}

/* Admin Panel */
#admin-panel {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: var(--panel);
  width: 700px;
  max-width: 90vw;
  padding: 30px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  display: none;
  color: var(--text);
  z-index: 10000;
  overflow-y: auto;
  max-height: 90vh;
}
#admin-panel label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}
#admin-panel input, #admin-panel select, #admin-panel textarea {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border-radius: 6px;
  border: none;
  background: #222b39;
  color: var(--text);
  font-size: 14px;
  font-family: ui-sans-serif, system-ui;
}
#admin-panel textarea { height: 80px; resize: vertical; }
#admin-panel button {
  margin-top: 16px;
  cursor: pointer;
}
#admin-error {
  color: #f87171;
  margin-top: 8px;
  font-weight: 700;
  min-height: 18px;
  text-align: center;
}
.roster-entry {
  display: flex;
  gap: 10px;
  margin-top: 6px;
}
.roster-entry input[type="text"] {
  flex: 1;
}
.roster-entry button.remove-btn {
  background: #ef4444;
  border: none;
  color: white;
  border-radius: 6px;
  padding: 4px 10px;
  cursor: pointer;
}
.add-roster-btn {
  margin-top: 8px;
  background: #60a5fa;
  border: none;
  color: white;
  border-radius: 6px;
  padding: 8px 16px;
  cursor: pointer;
}

/* For scroll inside admin panel */
#admin-content {
  max-height: 60vh;
  overflow-y: auto;
}
@media(max-width:1100px){
  .app{grid-template-columns:1fr}
  .sidebar{position:relative;height:auto}
}
</style>
</head>
<body>
<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand"><img src="https://cdn.discordapp.com/emojis/1407882144281264270.webp?size=96" alt="logo"> Hybrid Dash</div>
    <nav class="nav">
      <a class="active" data-tab="home">Home</a>
      <a data-tab="roster">Roster</a>
      <a data-tab="stats">Stats</a>
      <a data-tab="teams">Store</a>
      <a data-tab="discord">Discord</a>
    </nav>
    <!-- User Box -->
    <div id="user-box">
      <img id="user-pfp" src="" alt="pfp" />
      <span id="user-name"></span>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Home -->
    <section id="home" class="tab-section active">
      <header class="header"><h1>Welcome Back</h1></header>
      <div class="sub">Here's an overview of your league management dashboard, thanks for using Hybrid!</div>
      <div class="card">
        <h3>What is Hybrid?</h3>
        <div class="muted feature-text">
          <p>Boost your Roblox league with <strong>Hybrid</strong> ‚Äì the all-in-one Discord bot built for advanced utilities, fast performance, and nonstop reliability.</p>
          <ul class="feature-list">
            <li>üèÜ League Management ‚Äì Automate rosters, schedules, and roles</li>
            <li>üìä Statistics & Tracking ‚Äì Track performance and standings</li>
            <li>‚è± Fast Processing ‚Äì Lag-free performance</li>
            <li>üåê Reliable Network ‚Äì Uptime you can trust</li>
            <li>ü§ù Team Utilities ‚Äì Organize leagues with ease</li>
            <li>üîß Advanced Tools ‚Äì Flexible commands for all</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Roster -->
    <section id="roster" class="tab-section">
      <div class="card" id="roster-card">
        <h3>Roster</h3>
        <div id="roster-content">Your roster will load once you link your account.</div>
      </div>
    </section>

    <!-- Stats -->
    <section id="stats" class="tab-section">
      <div class="card" id="stats-card">
        <h3>Stats</h3>
        <div id="stats-content">Stats will appear once you connect Discord.</div>
      </div>
    </section>

    <!-- Store -->
    <section id="teams" class="tab-section">
      <div class="card">
        <h3>Purchase Hybrid Premium</h3>
        <a href="https://hybrid.sell.app/product/hybrid?store=hybrid&quantity=1" target="_blank" class="btn">Buy Now</a>
      </div>
    </section>

    <!-- Discord -->
    <section id="discord" class="tab-section">
      <div class="card" id="discord-card">
        <h3>Connect Your Discord</h3>
        <p class="muted" id="discord-invite-text">Login with Discord to personalize your dashboard.</p>
        <a id="discord-login" class="btn">Login with Discord</a>
        <a id="discord-invite" class="btn" target="_blank" href="https://discord.gg/kv2KQKAXAp" style="display:none; margin-top: 12px;">Join Our Discord Server</a>
      </div>
    </section>
  </main>
</div>

<!-- Admin Panel -->
<div id="admin-panel" tabindex="0">
  <h2>Admin Panel</h2>
  <div id="admin-error"></div>
  <label for="admin-password">Enter Password:</label>
  <input id="admin-password" type="password" autocomplete="off" />
  <button id="admin-login-btn">Login</button>
  <div id="admin-content" style="display:none;">
    <label for="admin-username">Discord Username:</label>
    <input id="admin-username" type="text" autocomplete="off" placeholder="example#1234" />
    
    <div id="roster-entries-container">
      <label>Roster Entries:</label>
      <!-- multiple roster entry inputs get inserted here -->
    </div>
    <button id="add-roster-entry" class="add-roster-btn">Add Roster Entry</button>
    
    <fieldset style="margin-top: 20px; border: 1px solid #444; padding: 10px; border-radius: 8px;">
      <legend><strong>Stats</strong></legend>
      <label>Games Played:
        <input id="stat-gamesPlayed" type="number" min="0" />
      </label>
      <label>Wins:
        <input id="stat-wins" type="number" min="0" />
      </label>
      <label>Losses:
        <input id="stat-losses" type="number" min="0" />
      </label>
      <label>Rank:
        <input id="stat-rank" type="text" />
      </label>
    </fieldset>

    <button id="admin-save-btn">Save</button>
    <button id="admin-logout-btn" style="margin-top:10px; background:#ef4444; color:white;">Logout</button>
  </div>
</div>

<!-- Cursor -->
<div id="cursor" style="position:fixed;top:0;left:0;width:16px;height:16px;border-radius:50%;background:#60a5fa;pointer-events:none;box-shadow:0 0 8px #60a5fa;transform:translate(-50%,-50%);z-index:9999;"></div>

<script>
// Cursor
const cursor=document.getElementById('cursor');
document.addEventListener('mousemove', e=>{
  cursor.style.left=e.clientX+'px';
  cursor.style.top=e.clientY+'px';
});

// Tabs
document.querySelectorAll('.nav a').forEach(link=>{
  link.addEventListener('click',()=>{
    document.querySelectorAll('.nav a').forEach(l=>l.classList.remove('active'));
    link.classList.add('active');
    document.querySelectorAll('.tab-section').forEach(tab=>tab.classList.remove('active'));
    document.getElementById(link.dataset.tab).classList.add('active');
  });
});

const CLIENT_ID = "1408648361548185643"; // Your Discord Client ID
const REDIRECT_URI = window.location.origin + window.location.pathname;
const OAUTH_URL = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;

// user data store keyed by username e.g. user#1234
const userDataStore = {};

// Show/hide user box and discord invite button
function onUserLogin(user, username) {
  document.getElementById("user-pfp").src = user.avatar
    ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
    : `https://cdn.discordapp.com/embed/avatars/0.png`;
  document.getElementById("user-name").textContent = username;
  document.getElementById("user-box").style.display = "flex";

  document.getElementById("discord-login").style.display = "none";
  document.getElementById("discord-invite").style.display = "inline-block";
  document.getElementById("discord-invite-text").textContent =
    "Thank you for connecting! Join our Discord for support and updates.";
}

// Update roster tab content
function updateRosterContent(username) {
  const rosterDiv = document.getElementById("roster-content");
  if (!userDataStore[username] || !userDataStore[username].rosters || userDataStore[username].rosters.length === 0) {
    rosterDiv.textContent = "No roster assigned.";
    return;
  }
  rosterDiv.innerHTML = "";
  userDataStore[username].rosters.forEach(r => {
    const div = document.createElement("div");
    div.style.marginBottom = "12px";
    div.innerHTML = `<strong>Team:</strong> ${r.team} <br> <strong>Role:</strong> ${r.role}`;
    rosterDiv.appendChild(div);
  });
}

// Update stats tab content
function updateStatsContent(username) {
  const statsDiv = document.getElementById("stats-content");
  if (!userDataStore[username] || !userDataStore[username].stats) {
    statsDiv.textContent = "No stats available.";
    return;
  }
  const stats = userDataStore[username].stats;
  statsDiv.innerHTML = `<p><strong>Games Played:</strong> ${stats.gamesPlayed || 0}</p>
       <p><strong>Wins:</strong> ${stats.wins || 0}</p>
       <p><strong>Losses:</strong> ${stats.losses || 0}</p>
       <p><strong>Rank:</strong> ${stats.rank || "Unranked"}</p>`;
}

// OAuth2 login flow
document.getElementById("discord-login").addEventListener("click", () => {
  window.location.href = OAUTH_URL;
});

if(window.location.hash.includes("access_token")){
  const params = new URLSearchParams(window.location.hash.replace("#","?"));
  const token = params.get("access_token");
  fetch("https://discord.com/api/users/@me", {
    headers: {Authorization: `Bearer ${token}`}
  }).then(res => res.json())
    .then(user => {
      const username = user.username + "#" + user.discriminator;
      window.loggedInUsername = username;
      onUserLogin(user, username);
      updateRosterContent(username);
      updateStatsContent(username);
    })
    .catch(e => console.error(e));
}

// ===== ADMIN PANEL ===== //
const adminPanel = document.getElementById("admin-panel");
const adminPasswordInput = document.getElementById("admin-password");
const adminLoginBtn = document.getElementById("admin-login-btn");
const adminContent = document.getElementById("admin-content");
const adminError = document.getElementById("admin-error");
const adminUsernameInput = document.getElementById("admin-username");
const rosterEntriesContainer = document.getElementById("roster-entries-container");
const addRosterEntryBtn = document.getElementById("add-roster-entry");
const statGamesInput = document.getElementById("stat-gamesPlayed");
const statWinsInput = document.getElementById("stat-wins");
const statLossesInput = document.getElementById("stat-losses");
const statRankInput = document.getElementById("stat-rank");
const adminSaveBtn = document.getElementById("admin-save-btn");
const adminLogoutBtn = document.getElementById("admin-logout-btn");

function clearRosterEntries() {
  rosterEntriesContainer.querySelectorAll(".roster-entry").forEach(entry => entry.remove());
}

function addRosterEntry(team = "", role = "") {
  const div = document.createElement("div");
  div.classList.add("roster-entry");
  div.innerHTML = `
    <input type="text" class="team-input" placeholder="Team Name" value="${team}" />
    <input type="text" class="role-input" placeholder="Role (Player, Coach, etc.)" value="${role}" />
    <button class="remove-btn" title="Remove">√ó</button>
  `;
  div.querySelector(".remove-btn").onclick = () => div.remove();
  rosterEntriesContainer.appendChild(div);
}

addRosterEntryBtn.onclick = () => addRosterEntry();

adminLoginBtn.onclick = () => {
  if (adminPasswordInput.value === "HybridAdmin3952") {
    adminError.textContent = "";
    adminContent.style.display = "block";
    adminPasswordInput.style.display = "none";
    adminLoginBtn.style.display = "none";
    if(window.loggedInUsername) {
      adminUsernameInput.value = window.loggedInUsername;
      loadUserData(window.loggedInUsername);
    }
  } else {
    adminError.textContent = "Incorrect password!";
  }
};

adminLogoutBtn.onclick = () => {
  adminPanel.style.display = "none";
  adminContent.style.display = "none";
  adminPasswordInput.style.display = "";
  adminPasswordInput.value = "";
  adminLoginBtn.style.display = "";
  adminError.textContent = "";
  adminUsernameInput.value = "";
  clearRosterEntries();
  statGamesInput.value = "";
  statWinsInput.value = "";
  statLossesInput.value = "";
  statRankInput.value = "";
};

function loadUserData(username) {
  clearRosterEntries();
  const u = userDataStore[username];
  if(u && u.rosters && u.rosters.length > 0){
    u.rosters.forEach(r => addRosterEntry(r.team, r.role));
  }
  if(u && u.stats) {
    statGamesInput.value = u.stats.gamesPlayed || "";
    statWinsInput.value = u.stats.wins || "";
    statLossesInput.value = u.stats.losses || "";
    statRankInput.value = u.stats.rank || "";
  } else {
    statGamesInput.value = "";
    statWinsInput.value = "";
    statLossesInput.value = "";
    statRankInput.value = "";
  }
  adminUsernameInput.value = username;
}

adminUsernameInput.onchange = () => loadUserData(adminUsernameInput.value.trim());

adminSaveBtn.onclick = () => {
  const username = adminUsernameInput.value.trim();
  if (!username) {
    adminError.textContent = "Please enter a Discord username.";
    return;
  }
  adminError.textContent = "";

  // Read roster entries
  const rosterEntries = Array.from(rosterEntriesContainer.querySelectorAll(".roster-entry")).map(entry => {
    return {
      team: entry.querySelector(".team-input").value.trim() || "Unknown",
      role: entry.querySelector(".role-input").value.trim() || "Player"
    };
  }).filter(r => r.team !== "");

  // Read stats
  const stats = {
    gamesPlayed: parseInt(statGamesInput.value) || 0,
    wins: parseInt(statWinsInput.value) || 0,
    losses: parseInt(statLossesInput.value) || 0,
    rank: statRankInput.value.trim() || "Unranked"
  };

  userDataStore[username] = {rosters: rosterEntries, stats};
  adminError.style.color = "#78e08f"; // green
  adminError.textContent = "Saved successfully!";

  if (username === window.loggedInUsername) {
    updateRosterContent(username);
    updateStatsContent(username);
  }
}

// Toggle admin panel on F10
document.addEventListener("keydown", e => {
  if (e.key === "F10") {
    e.preventDefault();
    if (adminPanel.style.display === "flex") {
      adminPanel.style.display = "none";
      adminContent.style.display = "none";
      adminPasswordInput.style.display = "";
      adminPasswordInput.value = "";
      adminLoginBtn.style.display = "";
      adminError.textContent = "";
      clearRosterEntries();
      statGamesInput.value = "";
      statWinsInput.value = "";
      statLossesInput.value = "";
      statRankInput.value = "";
    } else {
      adminPanel.style.display = "flex";
      adminPasswordInput.focus();
    }
  }
});
</script>
</body>
</html>
